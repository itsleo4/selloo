<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Selloo - Store</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #6366f1;
            --color-primary-light: #818cf8;
            --color-dark: #0f172a;
            --color-light: #f8fafc;
            --color-success: #10b981;
            --color-danger: #ef4444;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-heading {
            font-family: 'Space Grotesk', sans-serif;
        }
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .payment-modal {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex justify-between items-center">
                <a href="index.html" class="text-2xl font-bold text-gray-900 font-heading">Selloo</a>
                <a href="index.html" class="text-primary hover:text-primary-light transition">
                    <i class="fas fa-home"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Store Header -->
        <div class="text-center mb-12">
            <h1 id="store-header" class="text-3xl md:text-4xl font-bold text-gray-900 font-heading mb-2">
                <span class="text-primary">Loading Store...</span>
            </h1>
            <p class="text-gray-500 max-w-2xl mx-auto">Digital products available for purchase</p>
        </div>

        <!-- Product Grid -->
        <div id="publicStoreProducts" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Products will be loaded here -->
        </div>

        <!-- Empty State -->
        <div id="emptyStoreMessage" class="hidden text-center py-16">
            <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                <i class="fas fa-store text-gray-400 text-3xl"></i>
            </div>
            <h3 class="text-xl font-medium text-gray-700 mb-2">This store is empty</h3>
            <p class="text-gray-500 max-w-md mx-auto">The owner hasn't added any products yet.</p>
        </div>
    </main>

    <!-- Product Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto payment-modal">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-900">Complete Purchase</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="flex justify-center mb-6">
                    <img id="modalProductImage" src="" alt="Product" class="h-40 object-contain rounded-lg">
                </div>
                <h4 id="modalProductName" class="text-xl font-semibold text-gray-900 text-center"></h4>
                <p id="modalProductPrice" class="text-2xl font-bold text-primary text-center my-3"></p>
                <p id="modalProductDesc" class="text-gray-600 text-sm text-center mb-6"></p>
                
                <!-- Payment Options -->
                <div class="space-y-4">
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium text-gray-700 mb-3">Payment Methods</h5>
                        <div class="space-y-3">
                            <a id="modalPaymentLink" href="#" target="_blank" class="block w-full px-4 py-2 bg-primary text-white rounded-md text-center hover:bg-primary-light transition">
                                Pay Online
                            </a>
                            
                            <div id="modalQrCodeContainer" class="hidden">
                                <p class="text-xs text-gray-500 text-center mb-2">OR scan QR code</p>
                                <div class="flex justify-center">
                                    <img id="modalQrCode" src="" alt="Payment QR Code" class="h-32 w-32 object-contain border rounded-md">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium text-gray-700 mb-3">After Payment</h5>
                        <p class="text-sm text-gray-600 mb-3">Once payment is complete, click below to access your product:</p>
                        <div id="modalProductLinks" class="space-y-2">
                            <!-- Product links will be added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyAoe8uFfecihMO_FbCNQ3zIKikfHcVZy8A",
                authDomain: "selloo-6eb2b.firebaseapp.com",
                projectId: "selloo-6eb2b",
                storageBucket: "selloo-6eb2b.firebasestorage.app",
                messagingSenderId: "825664800500",
                appId: "1:825664800500:web:38001172e411163d3440a1",
                measurementId: "G-Y26MH0D6HD"
            };

            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();

            // DOM Elements
            const storeHeader = document.getElementById('store-header');
            const publicStoreProducts = document.getElementById('publicStoreProducts');
            const emptyStoreMessage = document.getElementById('emptyStoreMessage');
            const productModal = document.getElementById('productModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const modalProductImage = document.getElementById('modalProductImage');
            const modalProductName = document.getElementById('modalProductName');
            const modalProductPrice = document.getElementById('modalProductPrice');
            const modalProductDesc = document.getElementById('modalProductDesc');
            const modalPaymentLink = document.getElementById('modalPaymentLink');
            const modalQrCodeContainer = document.getElementById('modalQrCodeContainer');
            const modalQrCode = document.getElementById('modalQrCode');
            const modalProductLinks = document.getElementById('modalProductLinks');
            const pageTitle = document.getElementById('pageTitle');

            // Get store owner ID from URL
            function getQueryParam(param) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }

            // Render products
            function renderProducts(products, storeOwnerId) {
                publicStoreProducts.innerHTML = '';
                
                if (products.length === 0) {
                    emptyStoreMessage.classList.remove('hidden');
                } else {
                    emptyStoreMessage.classList.add('hidden');
                    
                    products.forEach(product => {
                        const productCard = document.createElement('div');
                        productCard.className = 'bg-white rounded-lg shadow-md overflow-hidden product-card';
                        productCard.innerHTML = `
                            <div class="relative">
                                <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-48 object-cover" onerror="this.src='https://placehold.co/400x300/e2e8f0/64748b?text=No+Image'">
                            </div>
                            <div class="p-4">
                                <h3 class="font-semibold text-gray-900 mb-1">${product.name}</h3>
                                <p class="text-primary font-bold text-lg mb-2">$${product.price}</p>
                                <p class="text-gray-600 text-sm mb-4 line-clamp-2">${product.description || 'No description'}</p>
                                <button class="view-product-btn w-full py-2 bg-primary text-white rounded-md hover:bg-primary-light transition" data-product-id="${product.id}">
                                    Buy Now
                                </button>
                            </div>
                        `;
                        
                        publicStoreProducts.appendChild(productCard);
                        
                        // Add click event to view product details
                        productCard.querySelector('.view-product-btn').addEventListener('click', () => {
                            showProductModal(product);
                        });
                    });
                }
            }

            // Show product modal
            function showProductModal(product) {
                modalProductImage.src = product.imageUrl;
                modalProductName.textContent = product.name;
                modalProductPrice.textContent = `$${product.price}`;
                modalProductDesc.textContent = product.description || '';
                modalPaymentLink.href = product.paymentLink;
                
                // Clear previous links
                modalProductLinks.innerHTML = '';
                
                // Add product links (if any)
                if (product.links && product.links.length > 0) {
                    product.links.forEach(link => {
                        if (link) {
                            const linkDiv = document.createElement('div');
                            linkDiv.className = 'border rounded-md p-3 bg-gray-50';
                            linkDiv.innerHTML = `
                                <a href="${link}" target="_blank" class="block w-full py-2 bg-green-500 text-white rounded-md text-center hover:bg-green-600 transition">
                                    Access Product
                                </a>
                                <p class="text-xs text-gray-500 mt-1 text-center">After payment</p>
                            `;
                            modalProductLinks.appendChild(linkDiv);
                        }
                    });
                }
                
                // Show QR code if available
                if (product.qrCodeUrl) {
                    modalQrCode.src = product.qrCodeUrl;
                    modalQrCodeContainer.classList.remove('hidden');
                } else {
                    modalQrCodeContainer.classList.add('hidden');
                }
                
                productModal.classList.remove('hidden');
            }

            // Close modal
            closeModalBtn.addEventListener('click', () => {
                productModal.classList.add('hidden');
            });

            // Load store data
            function loadStore() {
                const storeOwnerUserId = getQueryParam('uid');

                if (!storeOwnerUserId) {
                    storeHeader.innerHTML = '<span class="text-red-500">Store Not Found</span>';
                    emptyStoreMessage.querySelector('h3').textContent = "Store not found";
                    emptyStoreMessage.querySelector('p').textContent = "The store link you followed is invalid.";
                    emptyStoreMessage.classList.remove('hidden');
                    return;
                }

                // Set store title
                storeHeader.textContent = `${storeOwnerUserId}'s Store`;
                pageTitle.textContent = `Selloo - ${storeOwnerUserId}'s Store`;

                // Load products
                const productsRef = db.collection('users').doc(storeOwnerUserId).collection('products').orderBy('createdAt', 'desc');
                productsRef.onSnapshot(snapshot => {
                    const products = [];
                    snapshot.forEach(doc => {
                        products.push({ id: doc.id, ...doc.data() });
                    });
                    renderProducts(products, storeOwnerUserId);
                }, error => {
                    console.error("Error fetching products:", error);
                    storeHeader.innerHTML = '<span class="text-red-500">Error Loading Store</span>';
                    emptyStoreMessage.querySelector('h3').textContent = "Error loading store";
                    emptyStoreMessage.querySelector('p').textContent = "There was a problem loading this store. Please try again later.";
                    emptyStoreMessage.classList.remove('hidden');
                });
            }

            loadStore();
        });
    </script>
</body>
</html>